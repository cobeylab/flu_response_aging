mutate(spline_fit = ifelse(subtype == 'H1N1' & year >1957 & year <1977,
'NA', spline_fit)) %>% filter(subtype == 'H1N1')
as_tibble(divergence_spline_values) %>%
rename(year = x, spline_fit = y, subtype = PANEL, segment = group) %>%
mutate(spline_fit = ifelse(subtype == '2' & year >1957 & year <1977,
'NA', spline_fit)) %>% filter(subtype == '2')
as_tibble(divergence_spline_values) %>%
rename(year = x, spline_fit = y, subtype = PANEL, segment = group) %>%
mutate(spline_fit = ifelse(subtype == '2' & year >1957 & year <1977,
'NA', spline_fit)) %>% filter(subtype == '1')
as_tibble(divergence_spline_values) %>%
rename(year = x, spline_fit = y, subtype = PANEL, segment = group) %>%
mutate(spline_fit = ifelse(subtype == '2' & year >1957 & year <1977,
'NA', spline_fit)) %>% filter(subtype == '2')
as_tibble(divergence_spline_values) %>%
rename(year = x, spline_fit = y, subtype = PANEL, segment = group) %>%
mutate(spline_fit = ifelse(subtype == '2' & year >1957 & year <1977,
'NA', spline_fit)) %>% filter(subtype == '2', year > 1957)
divergence_spline_values <- as_tibble(divergence_spline_values) %>%
rename(year = x, spline_fit = y, subtype = PANEL, segment = group) %>%
mutate(spline_fit = ifelse(subtype == '2' & year >1957 & year <1977,
'NA', spline_fit))
switch(divergence_spline_values$subtype, 1 = H3N2, 2 = H1N1, 3=B\Victoria,4=B\Yamagata)
switch(divergence_spline_values$subtype, '1 = H3N2', '2 = H1N1', '3=B\Victoria','4=B\Yamagata')
switch(divergence_spline_values$subtype, '1 = H3N2', '2 = H1N1', '3=AAA','4=VVV')
switch(divergence_spline_values$subtype,
'1' = 'H3N2')
?switch
x <- 1
switch(x,
1 = 2)
switch(x,
'1' = 2)
switch(divergence_spline_values$subtype,
'1' = 'H3N2')
divergence_spline_values <- ggplot_build(ggplot(divergence_results, aes(x = year, y = distance_from_reference)) +
geom_smooth(se = F, aes(colour = segment)) + facet_grid(.~subtype))[[1]][[1]]
as_tibble(divergence_spline_values) %>%
rename(year = x, spline_fit = y, subtype = PANEL, segment = group) %>%
mutate(subtype = ifelse(subtype == '1','H3N2',ifelse(subtype == '2','H1N1',ifelse(subtype == '3','B\Victoria',ifelse(subtype == '4','B\Yamagata')))))
as_tibble(divergence_spline_values) %>%
rename(year = x, spline_fit = y, subtype = PANEL, segment = group) %>%
mutate(subtype = ifelse(subtype == '1','H3N2',ifelse(subtype == '2','H1N1',ifelse(subtype == '3','B\\Victoria',ifelse(subtype == '4','B\\Yamagata')))))
as_tibble(divergence_spline_values) %>%
rename(year = x, spline_fit = y, subtype = PANEL, segment = group) %>%
mutate(subtype = ifelse(subtype == '1', 'H3N2', subtype)) %>%
mutate(subtype = ifelse(subtype == '2', 'H1N1', subtype)) %>%
mutate(subtype = ifelse(subtype == '3', 'B\\Victoria', subtype)) %>%
mutate(subtype = ifelse(subtype == '4', 'B\\Yamagata', subtype))
as_tibble(divergence_spline_values) %>%
rename(year = x, spline_fit = y, subtype = PANEL, segment = group) %>%
mutate(subtype = ifelse(subtype == '1', 'H3N2', subtype)) %>%
mutate(subtype = ifelse(subtype == '2', 'H1N1', subtype)) %>%
mutate(subtype = ifelse(subtype == '3', 'B\Victoria', subtype)) %>%
mutate(subtype = ifelse(subtype == '4', 'B\Yamagata', subtype))
as_tibble(divergence_spline_values) %>%
rename(year = x, spline_fit = y, subtype = PANEL, segment = group) %>%
mutate(subtype = ifelse(subtype == '1', 'H3N2', subtype)) %>%
mutate(subtype = ifelse(subtype == '2', 'H1N1', subtype)) %>%
mutate(subtype = ifelse(subtype == '3', 'B\\Victoria', subtype)) %>%
mutate(subtype = ifelse(subtype == '4', 'B\\Yamagata', subtype)) %>%
mutate(subtype = factor(subtype, levels = c('H3N2','H1N1', 'B/Victoria','B/Yamagata'))
as_tibble(divergence_spline_values) %>%
rename(year = x, spline_fit = y, subtype = PANEL, segment = group) %>%
mutate(subtype = ifelse(subtype == '1', 'H3N2', subtype)) %>%
mutate(subtype = ifelse(subtype == '2', 'H1N1', subtype)) %>%
mutate(subtype = ifelse(subtype == '3', 'B\\Victoria', subtype)) %>%
mutate(subtype = ifelse(subtype == '4', 'B\\Yamagata', subtype)) %>%
mutate(subtype = factor(subtype, levels = c('H3N2','H1N1', 'B/Victoria','B/Yamagata')))
as_tibble(divergence_spline_values) %>%
rename(year = x, spline_fit = y, subtype = PANEL, segment = group) %>%
mutate(subtype = ifelse(subtype == '1', 'H3N2', subtype)) %>%
mutate(subtype = ifelse(subtype == '2', 'H1N1', subtype)) %>%
mutate(subtype = ifelse(subtype == '3', 'B\\Victoria', subtype)) %>%
mutate(subtype = ifelse(subtype == '4', 'B\\Yamagata', subtype)) %>%
mutate(subtype = factor(subtype, levels = c('H3N2','H1N1', 'B/Victoria','B/Yamagata'))) %>%
mutate(spline_fit = ifelse(subtype == 'H1N1' & year >1957 & year <1977,
'NA', spline_fit))
divergence_spline_values <- ggplot_build(ggplot(divergence_results, aes(x = year, y = distance_from_reference)) +
geom_smooth(se = F, aes(colour = segment)) + facet_grid(.~subtype))[[1]][[1]]
divergence_spline_values <- as_tibble(divergence_spline_values) %>%
rename(year = x, spline_fit = y, subtype = PANEL, segment = group) %>%
mutate(subtype = ifelse(subtype == '1', 'H3N2', subtype)) %>%
mutate(subtype = ifelse(subtype == '2', 'H1N1', subtype)) %>%
mutate(subtype = ifelse(subtype == '3', 'B\\Victoria', subtype)) %>%
mutate(subtype = ifelse(subtype == '4', 'B\\Yamagata', subtype)) %>%
mutate(subtype = factor(subtype, levels = c('H3N2','H1N1', 'B/Victoria','B/Yamagata'))) %>%
mutate(spline_fit = ifelse(subtype == 'H1N1' & year >1957 & year <1977,
'NA', spline_fit))
divergence_vs_time_plot
divergence_vs_time_plot <- ggplot(divergence_results, aes(x = year, y = distance_from_reference,
label = isolate_id)) +
geom_point(alpha = 0.5, size = 1.5, shape = 21,
aes(fill = segment, colour = segment), stroke = 0.0001) +
#geom_smooth(se = F, aes(colour = segment)) +
facet_grid(.~subtype, scales = 'free_x') +
xlab('Year') +
ylab('Amino acid divergence\nfrom reference strain') +
scale_fill_brewer(type = 'qual') +
scale_color_manual(values = c('springgreen4','darkorchid3','chocolate1')) +
theme(legend.position = c(0.003,0.78),
legend.title = element_text(size = 10),
legend.text = element_text(size = 10),
axis.text.x = element_text(size = 10))
divergence_vs_time_plot
ggplot(divergence_results, aes(x = year, y = distance_from_reference,
label = isolate_id)) +
geom_point(alpha = 0.5, size = 1.5, shape = 21,
aes(fill = segment, colour = segment), stroke = 0.0001) +
geom_smooth(se = F, aes(colour = segment)) +
facet_grid(.~subtype, scales = 'free_x') +
xlab('Year') +
ylab('Amino acid divergence\nfrom reference strain') +
scale_fill_brewer(type = 'qual') +
scale_color_manual(values = c('springgreen4','darkorchid3','chocolate1')) +
theme(legend.position = c(0.003,0.78),
legend.title = element_text(size = 10),
legend.text = element_text(size = 10),
axis.text.x = element_text(size = 10))
ggplot(divergence_results, aes(x = year, y = distance_from_reference,
label = isolate_id)) +
geom_point(alpha = 0.5, size = 1.5, shape = 21,
aes(fill = segment, colour = segment)) +
geom_smooth(se = F, aes(colour = segment)) +
facet_grid(.~subtype, scales = 'free_x') +
xlab('Year') +
ylab('Amino acid divergence\nfrom reference strain') +
scale_fill_brewer(type = 'qual') +
scale_color_manual(values = c('springgreen4','darkorchid3','chocolate1')) +
theme(legend.position = c(0.003,0.78),
legend.title = element_text(size = 10),
legend.text = element_text(size = 10),
axis.text.x = element_text(size = 10))
ggplot(divergence_results, aes(x = year, y = distance_from_reference,
label = isolate_id)) +
geom_point(alpha = 0.5, size = 1.5, shape = 21,
aes(fill = segment, colour = segment), stroke = 0.1) +
geom_smooth(se = F, aes(colour = segment)) +
facet_grid(.~subtype, scales = 'free_x') +
xlab('Year') +
ylab('Amino acid divergence\nfrom reference strain') +
scale_fill_brewer(type = 'qual') +
scale_color_manual(values = c('springgreen4','darkorchid3','chocolate1')) +
theme(legend.position = c(0.003,0.78),
legend.title = element_text(size = 10),
legend.text = element_text(size = 10),
axis.text.x = element_text(size = 10))
divergence_vs_time_plot <- ggplot(divergence_results, aes(x = year, y = distance_from_reference,
label = isolate_id)) +
geom_point(alpha = 0.5, size = 1.5, shape = 21,
aes(fill = segment, colour = segment), stroke = 0.1) +
geom_smooth(se = F, aes(colour = segment)) +
facet_grid(.~subtype, scales = 'free_x') +
xlab('Year') +
ylab('Amino acid divergence\nfrom reference strain') +
scale_fill_brewer(type = 'qual') +
scale_color_manual(values = c('springgreen4','darkorchid3','chocolate1')) +
theme(legend.position = c(0.003,0.78),
legend.title = element_text(size = 10),
legend.text = element_text(size = 10),
axis.text.x = element_text(size = 10))
divergence_vs_time_plot
ggplot(divergence_results, aes(x = year, y = distance_from_reference,
label = isolate_id)) +
geom_point(alpha = 0.5, size = 1.5, shape = 21,
aes(fill = segment, colour = segment), stroke = 0.1) +
#geom_smooth(se = F, aes(colour = segment)) +
facet_grid(.~subtype, scales = 'free_x') +
xlab('Year') +
ylab('Amino acid divergence\nfrom reference strain') +
scale_fill_brewer(type = 'qual') +
scale_color_manual(values = c('springgreen4','darkorchid3','chocolate1')) +
theme(legend.position = c(0.003,0.78),
legend.title = element_text(size = 10),
legend.text = element_text(size = 10),
axis.text.x = element_text(size = 10))
divergence_vs_time_plot +
geom_smooth(data = divergence_spline_valuesaes(colour = segment))
divergence_vs_time_plot +
geom_smooth(data = divergence_spline_values,aes(colour = segment))
divergence_vs_time_plot +
geom_smooth(data = divergence_spline_values,aes(colour = segment, y = spline_fit))
divergence_vs_time_plot <- ggplot(divergence_results, aes(x = year, y = distance_from_reference)) +
geom_point(alpha = 0.5, size = 1.5, shape = 21,
aes(fill = segment, colour = segment), stroke = 0.1) +
#geom_smooth(se = F, aes(colour = segment)) +
facet_grid(.~subtype, scales = 'free_x') +
xlab('Year') +
ylab('Amino acid divergence\nfrom reference strain') +
scale_fill_brewer(type = 'qual') +
scale_color_manual(values = c('springgreen4','darkorchid3','chocolate1')) +
theme(legend.position = c(0.003,0.78),
legend.title = element_text(size = 10),
legend.text = element_text(size = 10),
axis.text.x = element_text(size = 10))
divergence_vs_time_plot +
geom_smooth(data = divergence_spline_values,aes(colour = segment, y = spline_fit))
divergence_vs_time_plot +
geom_smooth(data = divergence_spline_values,aes(colour = segment, y = spline_fit,x = year))
divergence_vs_time_plot + scale_x_continuous()
divergence_vs_time_plot + scale_x_continuous()
geom_smooth(data = divergence_spline_values,aes(colour = segment, y = spline_fit,x = year))
divergence_vs_time_plot + scale_x_continuous()
geom_line(data = divergence_spline_values,aes(colour = segment, y = spline_fit,x = year))
ggplot(divergence_spline_values) + geom_line(aes(colour = segment, y = spline_fit,x = year))
divergence_spline_values
ggplot(divergence_spline_values) + geom_point(aes(colour = segment, y = spline_fit,x = year))
divergence_vs_time_plot + scale_x_continuous()
geom_point(data = divergence_spline_values,aes(colour = segment, y = spline_fit,x = year))
divergence_vs_time_plot + scale_x_continuous()
geom_point(data = divergence_spline_values,aes(y = spline_fit,x = year))
divergence_vs_time_plot + scale_x_continuous() +
geom_point(data = divergence_spline_values,aes(colour = segment, y = spline_fit,x = year))
divergence_vs_time_plot +
geom_point(data = divergence_spline_values,aes(colour = segment, y = spline_fit,x = year))
divergence_vs_time_plot + scale_x_discrete()
geom_point(data = divergence_spline_values,aes(colour = segment, y = spline_fit,x = year))
divergence_vs_time_plot + scale_x_discrete() +
geom_point(data = divergence_spline_values,aes(colour = segment, y = spline_fit,x = year))
divergence_vs_time_plot + scale_x_continuous() +
geom_point(data = divergence_spline_values,aes(colour = segment, y = spline_fit,x = year))
divergence_spline_values
divergence_spline_values <- ggplot_build(ggplot(divergence_results, aes(x = year, y = distance_from_reference)) +
geom_smooth(se = F, aes(colour = segment)) + facet_grid(.~subtype))[[1]][[1]]
divergence_spline_values <- as_tibble(divergence_spline_values) %>%
rename(year = x, spline_fit = y, subtype = PANEL, segment = group) %>%
mutate(subtype = ifelse(subtype == '1', 'H3N2', subtype)) %>%
mutate(subtype = ifelse(subtype == '2', 'H1N1', subtype)) %>%
mutate(subtype = ifelse(subtype == '3', 'B\\Victoria', subtype)) %>%
mutate(subtype = ifelse(subtype == '4', 'B\\Yamagata', subtype)) %>%
mutate(subtype = factor(subtype, levels = c('H3N2','H1N1', 'B/Victoria','B/Yamagata'))) %>%
mutate(spline_fit = ifelse(subtype == 'H1N1' & year >1957 & year <1977,
NA, spline_fit))
divergence_vs_time_plot +
geom_line(data = divergence_spline_values,aes(colour = segment, y = spline_fit,x = year))
divergence_spline_values
divergence_vs_time_plot
divergence_spline_values
divergence_vs_time_plot +
geom_line(data = divergence_spline_values,aes(y = spline_fit,x = year))
divergence_spline_values
as_tibble(divergence_spline_values) %>%
rename(year = x, spline_fit = y, subtype = PANEL, segment = group) %>%
mutate(subtype = ifelse(subtype == '1', 'H3N2', subtype)) %>%
mutate(subtype = ifelse(subtype == '2', 'H1N1', subtype)) %>%
mutate(subtype = ifelse(subtype == '3', 'B\\Victoria', subtype)) %>%
mutate(subtype = ifelse(subtype == '4', 'B\\Yamagata', subtype)) %>%
mutate(subtype = factor(subtype, levels = c('H3N2','H1N1', 'B/Victoria','B/Yamagata'))) %>%
mutate(segment = ifelse(segment == '1', 'HA', segment)) %>%
mutate(segment = ifelse(segment == '2', 'NA', segment)) %>%
mutate(segment = ifelse(segment == '3', 'NP', segment)) %>%
mutate(segment = factor(segment, levels = c('HA','NA','NP')) %>%
mutate(spline_fit = ifelse(subtype == 'H1N1' & year >1957 & year <1977,
NA, spline_fit))
divergence_spline_values <- ggplot_build(ggplot(divergence_results, aes(x = year, y = distance_from_reference)) +
geom_smooth(se = F, aes(colour = segment)) + facet_grid(.~subtype))[[1]][[1]]
divergence_spline_values <- as_tibble(divergence_spline_values) %>%
rename(year = x, spline_fit = y, subtype = PANEL, segment = group) %>%
mutate(subtype = ifelse(subtype == '1', 'H3N2', subtype)) %>%
mutate(subtype = ifelse(subtype == '2', 'H1N1', subtype)) %>%
mutate(subtype = ifelse(subtype == '3', 'B\\Victoria', subtype)) %>%
mutate(subtype = ifelse(subtype == '4', 'B\\Yamagata', subtype)) %>%
mutate(subtype = factor(subtype, levels = c('H3N2','H1N1', 'B/Victoria','B/Yamagata'))) %>%
mutate(segment = ifelse(segment == '1', 'HA', segment)) %>%
mutate(segment = ifelse(segment == '2', 'NA', segment)) %>%
mutate(segment = ifelse(segment == '3', 'NP', segment)) %>%
mutate(segment = factor(segment, levels = c('HA','NA','NP')) %>%
mutate(spline_fit = ifelse(subtype == 'H1N1' & year >1957 & year <1977,
NA, spline_fit))
divergence_spline_values <- ggplot_build(ggplot(divergence_results, aes(x = year, y = distance_from_reference)) +
geom_smooth(se = F, aes(colour = segment)) + facet_grid(.~subtype))[[1]][[1]]
divergence_spline_values <- as_tibble(divergence_spline_values) %>%
rename(year = x, spline_fit = y, subtype = PANEL, segment = group) %>%
mutate(subtype = ifelse(subtype == '1', 'H3N2', subtype)) %>%
mutate(subtype = ifelse(subtype == '2', 'H1N1', subtype)) %>%
mutate(subtype = ifelse(subtype == '3', 'B\\Victoria', subtype)) %>%
mutate(subtype = ifelse(subtype == '4', 'B\\Yamagata', subtype)) %>%
mutate(subtype = factor(subtype, levels = c('H3N2','H1N1', 'B/Victoria','B/Yamagata'))) %>%
mutate(segment = ifelse(segment == '1', 'HA', segment)) %>%
mutate(segment = ifelse(segment == '2', 'NA', segment)) %>%
mutate(segment = ifelse(segment == '3', 'NP', segment)) %>%
mutate(segment = factor(segment, levels = c('HA','NA','NP')) )%>%
mutate(spline_fit = ifelse(subtype == 'H1N1' & year >1957 & year <1977,
NA, spline_fit))
divergence_vs_time_plot +
geom_line(data = divergence_spline_values,aes(y = spline_fit,x = year))
divergence_spline_values
ggplot_build(ggplot(divergence_results, aes(x = year, y = distance_from_reference)) +
geom_smooth(se = F, aes(colour = segment)) + facet_grid(.~subtype))[[1]][[1]]
divergence_spline_values <- ggplot_build(ggplot(divergence_results, aes(x = year, y = distance_from_reference)) +
geom_smooth(se = F, aes(colour = segment)) + facet_grid(.~subtype))[[1]][[1]]
ggplot(divergence_spline_values, aes(x = x, y = y, color = group)) + geom_line() +
facet_grid(.~PANEL)
ggplot(divergence_spline_values, aes(x = x, y = y, color = group)) + geom_point() +
facet_grid(.~PANEL)
ggplot(divergence_spline_values, aes(x = x, y = y, color = factor(group))) + geom_point() +
facet_grid(.~PANEL)
ggplot(divergence_spline_values, aes(x = x, y = y, color = factor(group))) + geom_line() +
facet_grid(.~PANEL)
divergence_spline_values <- ggplot_build(ggplot(divergence_results, aes(x = year, y = distance_from_reference)) +
geom_smooth(se = F, aes(colour = segment)) + facet_grid(.~subtype))[[1]][[1]]
#ggplot(divergence_spline_values, aes(x = x, y = y, color = factor(group))) + geom_line() +
#  facet_grid(.~PANEL)
divergence_spline_values <- as_tibble(divergence_spline_values) %>%
rename(year = x, spline_fit = y, subtype = PANEL, segment = group) %>%
mutate(subtype = ifelse(subtype == '1', 'H3N2', subtype)) %>%
mutate(subtype = ifelse(subtype == '2', 'H1N1', subtype)) %>%
mutate(subtype = ifelse(subtype == '3', 'B\\Victoria', subtype)) %>%
mutate(subtype = ifelse(subtype == '4', 'B\\Yamagata', subtype)) %>%
mutate(subtype = factor(subtype, levels = c('H3N2','H1N1', 'B/Victoria','B/Yamagata'))) %>%
mutate(segment = ifelse(segment == '1', 'HA', segment)) %>%
mutate(segment = ifelse(segment == '2', 'NA', segment)) %>%
mutate(segment = ifelse(segment == '3', 'NP', segment)) %>%
mutate(segment = factor(segment, levels = c('HA','NA','NP')) )%>%
mutate(spline_fit = ifelse(subtype == 'H1N1' & year >1957 & year <1977,
NA, spline_fit))
divergence_vs_time_plot +
geom_line(data = divergence_spline_values,aes(y = spline_fit,x = year,
color = factor(segment)))
divergence_spline_values <- ggplot_build(ggplot(divergence_results, aes(x = year, y = distance_from_reference)) +
geom_smooth(se = F, aes(colour = segment)) + facet_grid(.~subtype))[[1]][[1]]
0
divergence_spline_values <- ggplot_build(ggplot(divergence_results, aes(x = year, y = distance_from_reference)) +
geom_smooth(se = F, aes(colour = segment)) + facet_grid(.~subtype))[[1]][[1]]
as_tibble(divergence_spline_values) %>%
rename(year = x, spline_fit = y, subtype = PANEL, segment = group) %>%
mutate(subtype = ifelse(subtype == '1', 'H3N2', subtype)) %>%
mutate(subtype = ifelse(subtype == '2', 'H1N1', subtype)) %>%
mutate(subtype = ifelse(subtype == '3', 'B\Victoria', subtype)) %>%
mutate(subtype = ifelse(subtype == '4', 'B\Yamagata', subtype)) %>%
mutate(subtype = factor(subtype, levels = c('H3N2','H1N1', 'B/Victoria','B/Yamagata'))) %>%
mutate(segment = ifelse(segment == '1', 'HA', segment)) %>%
mutate(segment = ifelse(segment == '2', 'NA', segment)) %>%
mutate(segment = ifelse(segment == '3', 'NP', segment)) %>%
mutate(segment = factor(segment, levels = c('HA','NA','NP')) )%>%
mutate(spline_fit = ifelse(subtype == 'H1N1' & year >1957 & year <1977,
NA, spline_fit))
as_tibble(divergence_spline_values)
as_tibble(divergence_spline_values) %>%
rename(year = x, spline_fit = y, subtype = PANEL, segment = group)
as_tibble(divergence_spline_values) %>%
rename(year = x, spline_fit = y, subtype = PANEL, segment = group) %>%
mutate(subtype = ifelse(subtype == '1', 'H3N2', subtype)) %>%
mutate(subtype = ifelse(subtype == '2', 'H1N1', subtype)) %>%
mutate(subtype = ifelse(subtype == '3', 'B\Victoria', subtype)) %>%
mutate(subtype = ifelse(subtype == '4', 'B\Yamagata', subtype))
as_tibble(divergence_spline_values) %>%
rename(year = x, spline_fit = y, subtype = PANEL, segment = group) %>%
mutate(subtype = ifelse(subtype == '1', 'H3N2', subtype)) %>%
mutate(subtype = ifelse(subtype == '2', 'H1N1', subtype)) %>%
mutate(subtype = ifelse(subtype == '3', 'B/Victoria', subtype)) %>%
mutate(subtype = ifelse(subtype == '4', 'B/Yamagata', subtype))
as_tibble(divergence_spline_values) %>%
rename(year = x, spline_fit = y, subtype = PANEL, segment = group) %>%
mutate(subtype = ifelse(subtype == '1', 'H3N2', subtype)) %>%
mutate(subtype = ifelse(subtype == '2', 'H1N1', subtype)) %>%
mutate(subtype = ifelse(subtype == '3', 'B/Victoria', subtype)) %>%
mutate(subtype = ifelse(subtype == '4', 'B/Yamagata', subtype)) %>%
mutate(subtype = factor(subtype, levels = c('H3N2','H1N1', 'B/Victoria','B/Yamagata'))) %>%
mutate(segment = ifelse(segment == '1', 'HA', segment)) %>%
mutate(segment = ifelse(segment == '2', 'NA', segment)) %>%
mutate(segment = ifelse(segment == '3', 'NP', segment)) %>%
mutate(segment = factor(segment, levels = c('HA','NA','NP')) )%>%
mutate(spline_fit = ifelse(subtype == 'H1N1' & year >1957 & year <1977,
NA, spline_fit))
divergence_spline_values <- as_tibble(divergence_spline_values) %>%
rename(year = x, spline_fit = y, subtype = PANEL, segment = group) %>%
mutate(subtype = ifelse(subtype == '1', 'H3N2', subtype)) %>%
mutate(subtype = ifelse(subtype == '2', 'H1N1', subtype)) %>%
mutate(subtype = ifelse(subtype == '3', 'B/Victoria', subtype)) %>%
mutate(subtype = ifelse(subtype == '4', 'B/Yamagata', subtype)) %>%
mutate(subtype = factor(subtype, levels = c('H3N2','H1N1', 'B/Victoria','B/Yamagata'))) %>%
mutate(segment = ifelse(segment == '1', 'HA', segment)) %>%
mutate(segment = ifelse(segment == '2', 'NA', segment)) %>%
mutate(segment = ifelse(segment == '3', 'NP', segment)) %>%
mutate(segment = factor(segment, levels = c('HA','NA','NP')) )%>%
mutate(spline_fit = ifelse(subtype == 'H1N1' & year >1957 & year <1977,
NA, spline_fit))
divergence_vs_time_plot +
geom_line(data = divergence_spline_values,aes(y = spline_fit,x = year,
color = factor(segment)))
glyc_vs_time_plot <- ggplot(divergence_results, aes(x = year, y = fraction_glyc_seq - fraction_glyc_ref ,
color = segment)) +
geom_point(alpha = 0.5, size = 1.5, shape = 21,
aes(fill = segment, colour = segment), stroke = 0.1) +
#geom_smooth(se = F, aes(colour = segment)) +
facet_grid(.~subtype, scales = 'free_x') +
xlab('Year') +
ylab('Change in fraction of\npotentially glycosylated sites') +
scale_fill_brewer(type = 'qual') +
scale_color_manual(values = c('springgreen4','darkorchid3','chocolate1')) +
theme(legend.position = c(0.003,0.78),
legend.title = element_text(size = 10),
legend.text = element_text(size = 10),
axis.text.x = element_text(size = 10))
glycosylation_spline_values <- ggplot_build(ggplot(divergence_results, aes(x = year, y = fraction_glyc_seq - fraction_glyc_ref)) +
geom_smooth(se = F, aes(colour = segment)) + facet_grid(.~subtype))[[1]][[1]]
glyc_vs_time_plot
glyc_vs_time_plot +
geom_line(data = divergence_spline_values,aes(y = spline_fit,x = year,
color = factor(segment)))
glycosylation_spline_values <- ggplot_build(ggplot(divergence_results, aes(x = year, y = fraction_glyc_seq - fraction_glyc_ref)) +
geom_smooth(se = F, aes(colour = segment)) + facet_grid(.~subtype))[[1]][[1]]
glycosylation_spline_values <- as_tibble(glycosylation_spline_values) %>%
rename(year = x, spline_fit = y, subtype = PANEL, segment = group) %>%
mutate(subtype = ifelse(subtype == '1', 'H3N2', subtype)) %>%
mutate(subtype = ifelse(subtype == '2', 'H1N1', subtype)) %>%
mutate(subtype = ifelse(subtype == '3', 'B/Victoria', subtype)) %>%
mutate(subtype = ifelse(subtype == '4', 'B/Yamagata', subtype)) %>%
mutate(subtype = factor(subtype, levels = c('H3N2','H1N1', 'B/Victoria','B/Yamagata'))) %>%
mutate(segment = ifelse(segment == '1', 'HA', segment)) %>%
mutate(segment = ifelse(segment == '2', 'NA', segment)) %>%
mutate(segment = ifelse(segment == '3', 'NP', segment)) %>%
mutate(segment = factor(segment, levels = c('HA','NA','NP')) )%>%
mutate(spline_fit = ifelse(subtype == 'H1N1' & year >1957 & year <1977,
NA, spline_fit))
glyc_vs_time_plot +
geom_line(data = divergence_spline_values,aes(y = spline_fit,x = year,
color = factor(segment)))
glycosylation_spline_values <- ggplot_build(ggplot(divergence_results, aes(x = year, y = fraction_glyc_seq - fraction_glyc_ref)) +
geom_smooth(se = F, aes(colour = segment)) + facet_grid(.~subtype))[[1]][[1]]
glycosylation_spline_values <- as_tibble(glycosylation_spline_values) %>%
rename(year = x, spline_fit = y, subtype = PANEL, segment = group) %>%
mutate(subtype = ifelse(subtype == '1', 'H3N2', subtype)) %>%
mutate(subtype = ifelse(subtype == '2', 'H1N1', subtype)) %>%
mutate(subtype = ifelse(subtype == '3', 'B/Victoria', subtype)) %>%
mutate(subtype = ifelse(subtype == '4', 'B/Yamagata', subtype)) %>%
mutate(subtype = factor(subtype, levels = c('H3N2','H1N1', 'B/Victoria','B/Yamagata'))) %>%
mutate(segment = ifelse(segment == '1', 'HA', segment)) %>%
mutate(segment = ifelse(segment == '2', 'NA', segment)) %>%
mutate(segment = ifelse(segment == '3', 'NP', segment)) %>%
mutate(segment = factor(segment, levels = c('HA','NA','NP')) )%>%
mutate(spline_fit = ifelse(subtype == 'H1N1' & year >1957 & year <1977,
NA, spline_fit))
glyc_vs_time_plot +
geom_line(data = glycosylation_spline_values,aes(y = spline_fit,x = year,
color = factor(segment)))
### AMINO ACID DIVERGENCE VS. TIME PLOT ###
divergence_vs_time_plot <- ggplot(divergence_results, aes(x = year, y = distance_from_reference)) +
geom_point(alpha = 0.5, size = 1.5, shape = 21,
aes(fill = segment, colour = segment), stroke = 0.1) +
#geom_smooth(se = F, aes(colour = segment)) +
facet_grid(.~subtype, scales = 'free_x') +
xlab('Year') +
ylab('Amino acid divergence\nfrom reference strain') +
scale_fill_brewer(type = 'qual') +
scale_color_manual(values = c('springgreen4','darkorchid3','chocolate1')) +
theme(legend.position = c(0.003,0.78),
legend.title = element_text(size = 10),
legend.text = element_text(size = 10),
axis.text.x = element_text(size = 10))
# Extract values from geom_point (to be able to ommit spline over gaps in the data)
divergence_spline_values <- ggplot_build(ggplot(divergence_results, aes(x = year, y = distance_from_reference)) +
geom_smooth(se = F, aes(colour = segment)) + facet_grid(.~subtype))[[1]][[1]]
divergence_spline_values <- as_tibble(divergence_spline_values) %>%
rename(year = x, spline_fit = y, subtype = PANEL, segment = group) %>%
mutate(subtype = ifelse(subtype == '1', 'H3N2', subtype)) %>%
mutate(subtype = ifelse(subtype == '2', 'H1N1', subtype)) %>%
mutate(subtype = ifelse(subtype == '3', 'B/Victoria', subtype)) %>%
mutate(subtype = ifelse(subtype == '4', 'B/Yamagata', subtype)) %>%
mutate(subtype = factor(subtype, levels = c('H3N2','H1N1', 'B/Victoria','B/Yamagata'))) %>%
mutate(segment = ifelse(segment == '1', 'HA', segment)) %>%
mutate(segment = ifelse(segment == '2', 'NA', segment)) %>%
mutate(segment = ifelse(segment == '3', 'NP', segment)) %>%
mutate(segment = factor(segment, levels = c('HA','NA','NP')) )%>%
mutate(spline_fit = ifelse(subtype == 'H1N1' & year >1957 & year <1977,
NA, spline_fit))
divergence_vs_time_plot <- divergence_vs_time_plot +
geom_line(data = divergence_spline_values,aes(y = spline_fit,x = year,
color = factor(segment)))
# ggsave crashing for some reason
pdf('../figures/divergence_vs_time_plot.pdf', height = 3, width = 10)
plot(divergence_vs_time_plot)
dev.off()
### PLOT WITH FRACTION OF GLYCOSYLATION SITES OVER TIME RELATIVE TO REFERENCE STRAIN ##
glyc_vs_time_plot <- ggplot(divergence_results, aes(x = year, y = fraction_glyc_seq - fraction_glyc_ref ,
color = segment)) +
geom_point(alpha = 0.5, size = 1.5, shape = 21,
aes(fill = segment, colour = segment), stroke = 0.1) +
#geom_smooth(se = F, aes(colour = segment)) +
facet_grid(.~subtype, scales = 'free_x') +
xlab('Year') +
ylab('Change in fraction of\npotentially glycosylated sites') +
scale_fill_brewer(type = 'qual') +
scale_color_manual(values = c('springgreen4','darkorchid3','chocolate1')) +
theme(legend.position = c(0.003,0.78),
legend.title = element_text(size = 10),
legend.text = element_text(size = 10),
axis.text.x = element_text(size = 10))
# Extract values from geom_point (to be able to ommit spline over gaps in the data)
glycosylation_spline_values <- ggplot_build(ggplot(divergence_results, aes(x = year, y = fraction_glyc_seq - fraction_glyc_ref)) +
geom_smooth(se = F, aes(colour = segment)) + facet_grid(.~subtype))[[1]][[1]]
glycosylation_spline_values <- as_tibble(glycosylation_spline_values) %>%
rename(year = x, spline_fit = y, subtype = PANEL, segment = group) %>%
mutate(subtype = ifelse(subtype == '1', 'H3N2', subtype)) %>%
mutate(subtype = ifelse(subtype == '2', 'H1N1', subtype)) %>%
mutate(subtype = ifelse(subtype == '3', 'B/Victoria', subtype)) %>%
mutate(subtype = ifelse(subtype == '4', 'B/Yamagata', subtype)) %>%
mutate(subtype = factor(subtype, levels = c('H3N2','H1N1', 'B/Victoria','B/Yamagata'))) %>%
mutate(segment = ifelse(segment == '1', 'HA', segment)) %>%
mutate(segment = ifelse(segment == '2', 'NA', segment)) %>%
mutate(segment = ifelse(segment == '3', 'NP', segment)) %>%
mutate(segment = factor(segment, levels = c('HA','NA','NP')) )%>%
mutate(spline_fit = ifelse(subtype == 'H1N1' & year >1957 & year <1977,
NA, spline_fit))
glyc_vs_time_plot <- glyc_vs_time_plot +
geom_line(data = glycosylation_spline_values,aes(y = spline_fit,x = year,
color = factor(segment)))
# ggsave crashing for some reason
pdf('../figures/new_glycosylation_sites_vs_time_plot.pdf', height = 3, width = 10)
plot(glyc_vs_time_plot)
dev.off()
